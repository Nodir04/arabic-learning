// Comprehensive vocabulary organized by categories
const vocabulary = {
    "–§—Ä—É–∫—Ç—ã": [
        { arabic: "ÿ™ŸèŸÅŸéŸëÿßÿ≠Ÿéÿ©", phonetic: "tuffƒÅ·∏•a", russian: "—è–±–ª–æ–∫–æ", image: "https://images.unsplash.com/photo-1560806887-1e4cd0b6cbd6?w=400" },
        { arabic: "ŸÖŸéŸàŸíÿ≤", phonetic: "mawz", russian: "–±–∞–Ω–∞–Ω", image: "https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=400" },
        { arabic: "ÿ®Ÿèÿ±Ÿíÿ™ŸèŸÇŸéÿßŸÑ", phonetic: "burtuqƒÅl", russian: "–∞–ø–µ–ª—å—Å–∏–Ω", image: "https://images.unsplash.com/photo-1580052614034-c55d20bfee3b?w=400" },
        { arabic: "ÿπŸêŸÜŸéÿ®", phonetic: " øinab", russian: "–≤–∏–Ω–æ–≥—Ä–∞–¥", image: "https://images.unsplash.com/photo-1599819177831-0d6bc36d6c95?w=400" },
        { arabic: "ŸÅŸéÿ±ŸéÿßŸàŸíŸÑŸéÿ©", phonetic: "farƒÅwla", russian: "–∫–ª—É–±–Ω–∏–∫–∞", image: "https://images.unsplash.com/photo-1464965911861-746a04b4bca6?w=400" },
        { arabic: "ÿ®Ÿéÿ∑ŸêŸëŸäÿÆ", phonetic: "ba·π≠·π≠ƒ´kh", russian: "–∞—Ä–±—É–∑", image: "https://images.unsplash.com/photo-1589984662646-e7b2e4962f18?w=400" },
        { arabic: "ŸÑŸéŸäŸíŸÖŸèŸàŸÜ", phonetic: "laym≈´n", russian: "–ª–∏–º–æ–Ω", image: "https://images.unsplash.com/photo-1590502593747-42a996133562?w=400" },
        { arabic: "ŸÉŸèŸÖŸéŸëÿ´Ÿíÿ±ŸéŸâ", phonetic: "kummthrƒÅ", russian: "–≥—Ä—É—à–∞", image: "https://images.unsplash.com/photo-1568031813264-d394c5d474b9?w=400" }
    ],
    "–û–≤–æ—â–∏": [
        { arabic: "ÿ∑ŸéŸÖŸéÿßÿ∑ŸêŸÖ", phonetic: "·π≠amƒÅ·π≠im", russian: "–ø–æ–º–∏–¥–æ—Ä", image: "https://images.unsplash.com/photo-1546094096-0df4bcaaa337?w=400" },
        { arabic: "ÿÆŸêŸäŸéÿßÿ±", phonetic: "khiyƒÅr", russian: "–æ–≥—É—Ä–µ—Ü", image: "https://images.unsplash.com/photo-1604977042946-1eecc30f269e?w=400" },
        { arabic: "ÿ®Ÿéÿ∑Ÿéÿßÿ∑Ÿêÿ≥", phonetic: "ba·π≠ƒÅ·π≠is", russian: "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", image: "https://images.unsplash.com/photo-1518977676601-b53f82aba655?w=400" },
        { arabic: "ÿ¨Ÿéÿ≤Ÿéÿ±", phonetic: "jazar", russian: "–º–æ—Ä–∫–æ–≤—å", image: "https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?w=400" },
        { arabic: "ÿ®ŸéÿµŸéŸÑ", phonetic: "ba·π£al", russian: "–ª—É–∫", image: "https://images.unsplash.com/photo-1587486937936-dfa2d8c96ab1?w=400" },
        { arabic: "ÿ´ŸèŸàŸÖ", phonetic: "th≈´m", russian: "—á–µ—Å–Ω–æ–∫", image: "https://images.unsplash.com/photo-1588697655023-cf3f3e8decf3?w=400" },
        { arabic: "ÿÆŸéÿ≥Ÿë", phonetic: "khass", russian: "—Å–∞–ª–∞—Ç", image: "https://images.unsplash.com/photo-1622206151226-18ca2c9ab4a1?w=400" }
    ],
    "–ß–∞—Å—Ç–∏ —Ç–µ–ª–∞": [
        { arabic: "ÿ±Ÿéÿ£Ÿíÿ≥", phonetic: "ra æs", russian: "–≥–æ–ª–æ–≤–∞", image: "https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=400" },
        { arabic: "ÿπŸéŸäŸíŸÜ", phonetic: " øayn", russian: "–≥–ª–∞–∑", image: "https://images.unsplash.com/photo-1585241936704-2bedec734824?w=400" },
        { arabic: "ÿ£Ÿèÿ∞ŸèŸÜ", phonetic: " æudhun", russian: "—É—Ö–æ", image: "https://images.unsplash.com/photo-1614436163996-25cee5f54290?w=400" },
        { arabic: "ÿ£ŸéŸÜŸíŸÅ", phonetic: " æanf", russian: "–Ω–æ—Å", image: "https://images.unsplash.com/photo-1599931955105-b7a5e9d04c38?w=400" },
        { arabic: "ŸÅŸéŸÖ", phonetic: "fam", russian: "—Ä–æ—Ç", image: "https://images.unsplash.com/photo-1606811841689-23dfddce3e95?w=400" },
        { arabic: "ŸäŸéÿØ", phonetic: "yad", russian: "—Ä—É–∫–∞", image: "https://images.unsplash.com/photo-1532938911079-1b06ac7ceec7?w=400" },
        { arabic: "ÿ±Ÿêÿ¨ŸíŸÑ", phonetic: "rijl", russian: "–Ω–æ–≥–∞", image: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400" },
        { arabic: "ŸÇŸéŸÑŸíÿ®", phonetic: "qalb", russian: "—Å–µ—Ä–¥—Ü–µ", image: "https://images.unsplash.com/photo-1594747850057-e0b6b41c4f49?w=400" }
    ],
    "–ñ–∏–≤–æ—Ç–Ω—ã–µ": [
        { arabic: "ŸÇŸêÿ∑ŸéŸëÿ©", phonetic: "qi·π≠·π≠a", russian: "–∫–æ—à–∫–∞", image: "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400" },
        { arabic: "ŸÉŸéŸÑŸíÿ®", phonetic: "kalb", russian: "—Å–æ–±–∞–∫–∞", image: "https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400" },
        { arabic: "ÿ≠ŸêÿµŸéÿßŸÜ", phonetic: "·∏•i·π£ƒÅn", russian: "–ª–æ—à–∞–¥—å", image: "https://images.unsplash.com/photo-1553284965-83fd3e82fa5a?w=400" },
        { arabic: "ÿ®ŸéŸÇŸéÿ±Ÿéÿ©", phonetic: "baqara", russian: "–∫–æ—Ä–æ–≤–∞", image: "https://images.unsplash.com/photo-1516467508483-a7212febe31a?w=400" },
        { arabic: "ÿ∑Ÿéÿßÿ¶Ÿêÿ±", phonetic: "·π≠ƒÅ æir", russian: "–ø—Ç–∏—Ü–∞", image: "https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=400" },
        { arabic: "ÿ≥ŸéŸÖŸéŸÉŸéÿ©", phonetic: "samaka", russian: "—Ä—ã–±–∞", image: "https://images.unsplash.com/photo-1524704654690-b56c05c78a00?w=400" },
        { arabic: "ÿ£Ÿéÿ±ŸíŸÜŸéÿ®", phonetic: " æarnab", russian: "–∫—Ä–æ–ª–∏–∫", image: "https://images.unsplash.com/photo-1585110396000-c9ffd4e4b308?w=400" },
        { arabic: "ŸÅŸéÿ£Ÿíÿ±", phonetic: "fa ær", russian: "–º—ã—à—å", image: "https://images.unsplash.com/photo-1425082661705-1834bfd09dca?w=400" }
    ],
    "–î–æ–º –∏ –º–µ–±–µ–ª—å": [
        { arabic: "ÿ®ŸéŸäŸíÿ™", phonetic: "bayt", russian: "–¥–æ–º", image: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400" },
        { arabic: "ÿ®Ÿéÿßÿ®", phonetic: "bƒÅb", russian: "–¥–≤–µ—Ä—å", image: "https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=400" },
        { arabic: "ŸÜŸéÿßŸÅŸêÿ∞Ÿéÿ©", phonetic: "nƒÅfidha", russian: "–æ–∫–Ω–æ", image: "https://images.unsplash.com/photo-1631889993959-41b4e9c6e3c5?w=400" },
        { arabic: "ŸÉŸèÿ±Ÿíÿ≥ŸêŸäŸë", phonetic: "kursiyy", russian: "—Å—Ç—É–ª", image: "https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?w=400" },
        { arabic: "ÿ∑ŸéÿßŸàŸêŸÑŸéÿ©", phonetic: "·π≠ƒÅwila", russian: "—Å—Ç–æ–ª", image: "https://images.unsplash.com/photo-1530018607912-eff2daa1bac4?w=400" },
        { arabic: "ÿ≥Ÿéÿ±ŸêŸäÿ±", phonetic: "sarƒ´r", russian: "–∫—Ä–æ–≤–∞—Ç—å", image: "https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=400" },
        { arabic: "ŸÖŸêÿµŸíÿ®Ÿéÿßÿ≠", phonetic: "mi·π£bƒÅ·∏•", russian: "–ª–∞–º–ø–∞", image: "https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=400" },
        { arabic: "ÿ≥Ÿéÿ¨ŸéŸëÿßÿØŸéÿ©", phonetic: "sajjƒÅda", russian: "–∫–æ–≤—ë—Ä", image: "https://images.unsplash.com/photo-1600166898405-da9535204843?w=400" }
    ],
    "–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏": [
        { arabic: "ÿÆŸèÿ®Ÿíÿ≤", phonetic: "khubz", russian: "—Ö–ª–µ–±", image: "https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400" },
        { arabic: "ÿ£Ÿéÿ±Ÿèÿ≤Ÿë", phonetic: " æaruzz", russian: "—Ä–∏—Å", image: "https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400" },
        { arabic: "ŸÑŸéÿ≠ŸíŸÖ", phonetic: "la·∏•m", russian: "–º—è—Å–æ", image: "https://images.unsplash.com/photo-1602470520998-f4a52199a3d6?w=400" },
        { arabic: "ÿ¨Ÿèÿ®ŸíŸÜ", phonetic: "jubn", russian: "—Å—ã—Ä", image: "https://images.unsplash.com/photo-1486297678162-eb2a19b0a32d?w=400" },
        { arabic: "ÿ®ŸéŸäŸíÿ∂", phonetic: "bay·∏ç", russian: "—è–π—Ü–æ", image: "https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=400" },
        { arabic: "ŸÖŸéÿßÿ°", phonetic: "mƒÅ æ", russian: "–≤–æ–¥–∞", image: "https://images.unsplash.com/photo-1548839140-29a749e1cf4d?w=400" },
        { arabic: "ÿ≠ŸéŸÑŸêŸäÿ®", phonetic: "·∏•alƒ´b", russian: "–º–æ–ª–æ–∫–æ", image: "https://images.unsplash.com/photo-1563636619-e9143da7973b?w=400" },
        { arabic: "ÿ¥ŸéÿßŸä", phonetic: "shƒÅy", russian: "—á–∞–π", image: "https://images.unsplash.com/photo-1564890369478-c89ca6d9cde9?w=400" },
        { arabic: "ŸÇŸéŸáŸíŸàŸéÿ©", phonetic: "qahwa", russian: "–∫–æ—Ñ–µ", image: "https://images.unsplash.com/photo-1511920170033-f8396924c348?w=400" }
    ],
    "–®–∫–æ–ª–∞": [
        { arabic: "ŸÉŸêÿ™Ÿéÿßÿ®", phonetic: "kitƒÅb", russian: "–∫–Ω–∏–≥–∞", image: "https://images.unsplash.com/photo-1512820790803-83ca734da794?w=400" },
        { arabic: "ŸÇŸéŸÑŸéŸÖ", phonetic: "qalam", russian: "—Ä—É—á–∫–∞", image: "https://images.unsplash.com/photo-1586158291800-2665f07bba79?w=400" },
        { arabic: "ÿØŸéŸÅŸíÿ™Ÿéÿ±", phonetic: "daftar", russian: "—Ç–µ—Ç—Ä–∞–¥—å", image: "https://images.unsplash.com/photo-1517842645767-c639042777db?w=400" },
        { arabic: "ŸÖŸêŸÖŸíÿ≠Ÿéÿßÿ©", phonetic: "mim·∏•ƒÅ æa", russian: "–ª–∞—Å—Ç–∏–∫", image: "https://images.unsplash.com/photo-1589127827957-3c1bae2eaf3d?w=400" },
        { arabic: "ŸÖŸêÿ≥Ÿíÿ∑Ÿéÿ±Ÿéÿ©", phonetic: "mis·π≠ara", russian: "–ª–∏–Ω–µ–π–∫–∞", image: "https://images.unsplash.com/photo-1625948515291-69613efd103f?w=400" },
        { arabic: "ÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ©", phonetic: "·∏•aqƒ´ba", russian: "—Å—É–º–∫–∞", image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400" }
    ],
    "–ü—Ä–∏—Ä–æ–¥–∞": [
        { arabic: "ÿ¥ŸéŸÖŸíÿ≥", phonetic: "shams", russian: "—Å–æ–ª–Ω—Ü–µ", image: "https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=400" },
        { arabic: "ŸÇŸéŸÖŸéÿ±", phonetic: "qamar", russian: "–ª—É–Ω–∞", image: "https://images.unsplash.com/photo-1509903316079-449faef593e1?w=400" },
        { arabic: "ŸÜŸéÿ¨ŸíŸÖ", phonetic: "najm", russian: "–∑–≤–µ–∑–¥–∞", image: "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400" },
        { arabic: "ÿ¥Ÿéÿ¨Ÿéÿ±Ÿéÿ©", phonetic: "shajara", russian: "–¥–µ—Ä–µ–≤–æ", image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400" },
        { arabic: "ÿ≤ŸéŸáŸíÿ±Ÿéÿ©", phonetic: "zahra", russian: "—Ü–≤–µ—Ç–æ–∫", image: "https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=400" },
        { arabic: "ŸÖŸéÿ∑Ÿéÿ±", phonetic: "ma·π≠ar", russian: "–¥–æ–∂–¥—å", image: "https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=400" },
        { arabic: "ÿ´ŸéŸÑŸíÿ¨", phonetic: "thalj", russian: "—Å–Ω–µ–≥", image: "https://images.unsplash.com/photo-1491002052546-bf38f186af56?w=400" },
        { arabic: "ÿ®Ÿéÿ≠Ÿíÿ±", phonetic: "ba·∏•r", russian: "–º–æ—Ä–µ", image: "https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=400" }
    ],
    "–¶–≤–µ—Ç–∞": [
        { arabic: "ÿ£Ÿéÿ≠ŸíŸÖŸéÿ±", phonetic: " æa·∏•mar", russian: "–∫—Ä–∞—Å–Ω—ã–π", image: "https://images.unsplash.com/photo-1525328437458-0c4d4db7cab4?w=400" },
        { arabic: "ÿ£Ÿéÿ≤Ÿíÿ±ŸéŸÇ", phonetic: " æazraq", russian: "—Å–∏–Ω–∏–π", image: "https://images.unsplash.com/photo-1557682250-33bd709cbe85?w=400" },
        { arabic: "ÿ£ŸéÿÆŸíÿ∂Ÿéÿ±", phonetic: " æakh·∏çar", russian: "–∑–µ–ª—ë–Ω—ã–π", image: "https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=400" },
        { arabic: "ÿ£ŸéÿµŸíŸÅŸéÿ±", phonetic: " æa·π£far", russian: "–∂—ë–ª—Ç—ã–π", image: "https://images.unsplash.com/photo-1519852476561-ec618b0183ba?w=400" },
        { arabic: "ÿ£Ÿéÿ®ŸíŸäŸéÿ∂", phonetic: " æabya·∏ç", russian: "–±–µ–ª—ã–π", image: "https://images.unsplash.com/photo-1534401661080-c4bcf0296b66?w=400" },
        { arabic: "ÿ£Ÿéÿ≥ŸíŸàŸéÿØ", phonetic: " æaswad", russian: "—á—ë—Ä–Ω—ã–π", image: "https://images.unsplash.com/photo-1518895312237-a9e23508077d?w=400" }
    ],
    "–°–µ–º—å—è": [
        { arabic: "ÿ£Ÿéÿ®", phonetic: " æab", russian: "–æ—Ç–µ—Ü", image: "https://images.unsplash.com/photo-1500672860114-9e913f298978?w=400" },
        { arabic: "ÿ£ŸèŸÖŸë", phonetic: " æumm", russian: "–º–∞—Ç—å", image: "https://images.unsplash.com/photo-1562845799-3b0826e4d033?w=400" },
        { arabic: "ÿßÿ®ŸíŸÜ", phonetic: "ibn", russian: "—Å—ã–Ω", image: "https://images.unsplash.com/photo-1519340333755-56e9c1d6e3f6?w=400" },
        { arabic: "ÿ®ŸêŸÜŸíÿ™", phonetic: "bint", russian: "–¥–æ—á—å", image: "https://images.unsplash.com/photo-1580905762356-baf48dc0f0a3?w=400" },
        { arabic: "ÿ£ŸéÿÆ", phonetic: " æakh", russian: "–±—Ä–∞—Ç", image: "https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=400" },
        { arabic: "ÿ£ŸèÿÆŸíÿ™", phonetic: " æukht", russian: "—Å–µ—Å—Ç—Ä–∞", image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400" },
        { arabic: "ÿ¨ŸéÿØŸë", phonetic: "jadd", russian: "–¥–µ–¥—É—à–∫–∞", image: "https://images.unsplash.com/photo-1566616213894-2d4e1baee5d8?w=400" },
        { arabic: "ÿ¨ŸéÿØŸéŸëÿ©", phonetic: "jadda", russian: "–±–∞–±—É—à–∫–∞", image: "https://images.unsplash.com/photo-1594038181451-bdb76e0fe1c6?w=400" }
    ]
};

let currentCategory = "all";
let currentWords = [];
let currentIndex = 0;
let filteredWords = [];

// Elements
const arabicEl = document.getElementById('arabic');
const phoneticEl = document.getElementById('phonetic');
const russianEl = document.getElementById('russian');
const imageEl = document.getElementById('image');
const categoryBadgeEl = document.getElementById('categoryBadge');
const currentEl = document.getElementById('current');
const totalEl = document.getElementById('total');
const playBtn = document.getElementById('playAudio');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const searchBox = document.getElementById('searchBox');
const categorySelect = document.getElementById('categorySelect');
const cardContainer = document.getElementById('cardContainer');

// Initialize
function init() {
    // Populate category dropdown
    Object.keys(vocabulary).forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
    });

    loadAllWords();
    updateCard();
}

function loadAllWords() {
    currentWords = [];
    Object.keys(vocabulary).forEach(category => {
        vocabulary[category].forEach(word => {
            currentWords.push({ ...word, category });
        });
    });
    filteredWords = [...currentWords];
}

function filterByCategory(category) {
    currentCategory = category;
    if (category === "all") {
        loadAllWords();
    } else {
        currentWords = vocabulary[category].map(word => ({ ...word, category }));
        filteredWords = [...currentWords];
    }
    currentIndex = 0;
    filterBySearch(searchBox.value);
}

function filterBySearch(query) {
    query = query.toLowerCase().trim();
    if (!query) {
        filteredWords = [...currentWords];
    } else {
        filteredWords = currentWords.filter(word => 
            word.russian.toLowerCase().includes(query)
        );
    }
    
    currentIndex = 0;
    if (filteredWords.length === 0) {
        showNoResults();
    } else {
        updateCard();
    }
}

function showNoResults() {
    cardContainer.innerHTML = '<div class="no-results">üòî –°–ª–æ–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ<br>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å</div>';
}

function updateCard() {
    if (filteredWords.length === 0) {
        showNoResults();
        return;
    }

    // Restore card if it was replaced by no-results message
    if (cardContainer.querySelector('.no-results')) {
        cardContainer.innerHTML = `
            <div class="card">
                <div class="category-badge" id="categoryBadge"></div>
                <div class="arabic-word" id="arabic"></div>
                <div class="phonetic" id="phonetic"></div>
                <div class="image-container">
                    <img class="word-image" id="image" src="" alt="">
                </div>
                <div class="russian-word" id="russian"></div>
                <button class="audio-button" id="playAudio">üîä –°–ª—É—à–∞—Ç—å</button>
            </div>
            <div class="navigation">
                <button class="nav-button" id="prevBtn">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="nav-button" id="nextBtn">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
            </div>
        `;
        
        // Re-attach event listeners
        document.getElementById('playAudio').addEventListener('click', playAudio);
        document.getElementById('prevBtn').addEventListener('click', prevWord);
        document.getElementById('nextBtn').addEventListener('click', nextWord);
    }

    const word = filteredWords[currentIndex];
    document.getElementById('arabic').textContent = word.arabic;
    document.getElementById('phonetic').textContent = word.phonetic;
    document.getElementById('russian').textContent = word.russian;
    document.getElementById('image').src = word.image;
    document.getElementById('image').alt = word.russian;
    document.getElementById('categoryBadge').textContent = word.category;
    currentEl.textContent = currentIndex + 1;
    totalEl.textContent = filteredWords.length;

    // Update button states
    document.getElementById('prevBtn').disabled = currentIndex === 0;
    document.getElementById('nextBtn').disabled = currentIndex === filteredWords.length - 1;
}

async function playAudio() {
    if (filteredWords.length === 0) return;
    
    const word = filteredWords[currentIndex];
    const button = document.getElementById('playAudio');
    
    // Disable button while loading
    button.disabled = true;
    button.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
    
    try {
        // Use Hugging Face Inference API for Facebook MMS TTS
        const response = await fetch(
            "https://api-inference.huggingface.co/models/facebook/mms-tts-ara",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    inputs: word.arabic
                })
            }
        );

        if (!response.ok) {
            throw new Error('TTS service unavailable');
        }

        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        const audio = new Audio(audioUrl);
        
        audio.onended = () => {
            URL.revokeObjectURL(audioUrl);
            button.disabled = false;
            button.textContent = 'üîä –°–ª—É—à–∞—Ç—å';
        };
        
        audio.onerror = () => {
            throw new Error('Audio playback failed');
        };
        
        await audio.play();
        
    } catch (error) {
        console.error('TTS Error:', error);
        // Fallback to browser TTS
        const utterance = new SpeechSynthesisUtterance(word.arabic);
        utterance.lang = 'ar-SA';
        utterance.rate = 0.75;
        utterance.pitch = 1.0;
        
        utterance.onend = () => {
            button.disabled = false;
            button.textContent = 'üîä –°–ª—É—à–∞—Ç—å';
        };
        
        speechSynthesis.speak(utterance);
    }
}

function prevWord() {
    if (currentIndex > 0) {
        currentIndex--;
        updateCard();
    }
}

function nextWord() {
    if (currentIndex < filteredWords.length - 1) {
        currentIndex++;
        updateCard();
    }
}

// Event listeners
playBtn.addEventListener('click', playAudio);
prevBtn.addEventListener('click', prevWord);
nextBtn.addEventListener('click', nextWord);

searchBox.addEventListener('input', (e) => {
    filterBySearch(e.target.value);
});

categorySelect.addEventListener('change', (e) => {
    filterByCategory(e.target.value);
});

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (e.target === searchBox) return;
    
    if (e.key === 'ArrowLeft' && currentIndex > 0) {
        currentIndex--;
        updateCard();
    } else if (e.key === 'ArrowRight' && currentIndex < filteredWords.length - 1) {
        currentIndex++;
        updateCard();
    } else if (e.key === ' ') {
        e.preventDefault();
        playAudio();
    }
});

// Initialize app
init();